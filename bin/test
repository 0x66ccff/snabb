#!/bin/bash
snabb=$(cd `dirname $0`/..; pwd)

tmpdir=$(mktemp -d /tmp/snabbtest.XXXX)
trap "rm -rf $tmpdir" EXIT

# Setup the environment expected by the tester.
[ -n "$TEST_VERBOSE" ] && echo "Setting up test environment.."
cd $tmpdir
export PATH=$snabb/bin:$PATH
export LD_LIBRARY_PATH=$snabb/src/c
tracemaker

# Run the tests
[ -n "$TEST_VERBOSE" ] && echo "Running tests.."
exec luajit -e "package.path = package.path .. \";$fabric_dir/src/lua/?.lua\"" \
            $snabb/src/lua/test.lua "$@"
